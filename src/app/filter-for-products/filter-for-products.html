<!-- product-filter.component.html -->

<!-- Mobile Filter Button (visible only on mobile) -->
<button
  (click)="toggleFilter()"
  class="md:hidden fixed bottom-15 right-4 z-40 bg-bluematik text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-2 hover:bg-bluematik-600 transition-all duration-200">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="4" y1="21" x2="4" y2="14"></line>
    <line x1="4" y1="10" x2="4" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="12"></line>
    <line x1="12" y1="8" x2="12" y2="3"></line>
    <line x1="20" y1="21" x2="20" y2="16"></line>
    <line x1="20" y1="12" x2="20" y2="3"></line>
    <line x1="1" y1="14" x2="7" y2="14"></line>
    <line x1="9" y1="8" x2="15" y2="8"></line>
    <line x1="17" y1="16" x2="23" y2="16"></line>
  </svg>
  Filters
</button>

<!-- Overlay (mobile only) -->
@if (isFilterOpen) {
  <div
    (click)="closeFilter()"
    class="md:hidden fixed inset-0 blur-2xl z-40 transition-opacity duration-300">
  </div>
}

<!-- Filter Panel -->
<div
  [class]="isFilterOpen
    ? 'filterWrapper fixed bottom-10 left-0 right-0 z-9996 bg-white rounded-t-3xl shadow-2xl transition-transform duration-300 transform translate-y-0 max-h-[80vh] overflow-y-auto md:sticky md:top-4 md:translate-y-0 md:w-w-full md:h-fit md:max-h-[calc(100vh-2rem)] md:bg-gray-100 md:rounded-xl p-4'
    : 'filterWrapper fixed bottom-10 left-0 right-0 z-9996 bg-white rounded-t-3xl shadow-2xl transition-transform duration-300 transform translate-y-full md:sticky md:top-4 md:translate-y-0 md:w-full md:h-fit md:max-h-[calc(100vh-2rem)] md:bg-white md:rounded-xl p-4'">
  <!-- Mobile Header -->
  <div class="md:hidden flex items-center justify-between mb-4 pb-4 border-b">
    <h2 class="text-xl font-bold text-bluematik">Filter Products</h2>
    <button
      (click)="closeFilter()"
      class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Desktop Header -->
  <h2 class="hidden md:block text-xl font-bold text-bluematik mb-4 text-center">Filter Products</h2>

  <!-- Category Section -->
  <h3 class="text-bluematik text-xl text-left p-2 font-semibold">Category</h3>
  <div class="max-h-48 overflow-y-auto">
    @for(cat of headcategories; track cat.ID) {
      <label class="flex items-center gap-2 p-2 text-sm hover:bg-gray-50 rounded cursor-pointer">
        <input type="checkbox" class="form-checkbox h-5 w-5 accent-bluematik rounded">
        <span class="text-gray-700">{{ cat.CustomHeadCategoryNameEN }}</span>
      </label>
    }
  </div>

  <!-- Price Section -->
  <h3 class="text-bluematik text-xl text-left p-2 font-semibold mt-4">Price</h3>
  <div class="w-full p-2">
    <!-- Values -->
    <div class="flex justify-between text-sm mb-4">
      <span class="font-medium text-gray-700">{{ minValue }} €</span>
      <span class="font-medium text-gray-700">{{ maxValue }} €</span>
    </div>

    <!-- Slider -->
    <div class="relative h-2">
      <!-- Track -->
      <div class="absolute inset-0 bg-gray-200 rounded-full"></div>

      <!-- Active range -->
      <div
        class="absolute h-2 bg-bluematik rounded-full"
        [style.left.%]="leftPercent"
        [style.width.%]="rangeWidth">
      </div>

      <!-- Min -->
      <input
        type="range"
        [min]="min"
        [max]="max"
        [step]="step"
        [(ngModel)]="minValue"
        (input)="onMinChange()"
        [style.zIndex]="minValue >= maxValue - gap ? 40 : 30"
        class="range-thumb pointer-events-none absolute inset-0 w-full appearance-none bg-transparent z-20"
      />

      <!-- Max -->
      <input
        type="range"
        [min]="min"
        [max]="max"
        [step]="step"
        [(ngModel)]="maxValue"
        (input)="onMaxChange()"
        [style.zIndex]="maxValue <= minValue + gap ? 40 : 20"
        class="range-thumb pointer-events-none absolute inset-0 w-full appearance-none bg-transparent z-30"
      />
    </div>
  </div>

  <!-- Mobile Apply Button -->
  <div class="md:hidden mt-6 pt-4 border-t">
    <button
      (click)="applyFilters()"
      class="w-full bg-bluematik text-white py-3 rounded-lg font-semibold hover:bg-bluematik-600 transition-colors">
      Apply Filters
    </button>
  </div>
</div>


